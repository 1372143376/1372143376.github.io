<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="contact-title">联系我们 - 在线工具箱</title>
    <link rel="stylesheet" href="css/main.css?v=1.2">
    <link rel="stylesheet" href="css/tool.css?v=1.21">
    <script>
        // 在页面加载的最早时机就设置语言
        (function() {
            const savedLang = localStorage.getItem('language');
            if (savedLang && (savedLang === 'zh' || savedLang === 'en')) {
                document.documentElement.lang = savedLang === 'zh' ? 'zh-CN' : 'en';
            }
        })();
    </script>
    <script>
        // 备用加载方案
        function loadI18nFallback() {
            console.warn('Trying to load i18n.js with fallback method...');
            const script = document.createElement('script');
            script.src = '/js/i18n.js?v=' + Date.now();
            script.onerror = function() {
                console.error('Failed to load i18n.js even with fallback method');
            };
            script.onload = function() {
                console.log('i18n.js loaded successfully with fallback method');
                setTimeout(initI18n, 50);
            };
            document.head.appendChild(script);
        }
        
        // i18n.js 加载后立即初始化
        function initI18n() {
            if (typeof i18n === 'undefined') {
                if (typeof initI18n.attempts === 'undefined') {
                    initI18n.attempts = 0;
                }
                initI18n.attempts++;
                if (initI18n.attempts < 100) {
                    setTimeout(initI18n, 50);
                } else {
                    console.error('i18n is still undefined after 5 seconds, trying fallback...');
                    if (!document.querySelector('script[src*="i18n.js"][data-fallback="true"]')) {
                        loadI18nFallback();
                    }
                }
                return;
            }
            
            const savedLang = localStorage.getItem('language');
            if (savedLang && (savedLang === 'zh' || savedLang === 'en')) {
                i18n.currentLang = savedLang;
                document.documentElement.lang = savedLang === 'zh' ? 'zh-CN' : 'en';
            }
            
            if (document.body) {
                i18n.init();
            } else {
                if (document.readyState === 'loading') {
                    document.addEventListener('DOMContentLoaded', function() {
                        i18n.init();
                    });
                } else {
                    setTimeout(function() { i18n.init(); }, 0);
                }
            }
        }
    </script>
    <script src="/js/i18n.js" onerror="console.error('Failed to load i18n.js'); loadI18nFallback();" onload="setTimeout(initI18n, 50);"></script>
    <script>
        setTimeout(function() {
            if (typeof i18n === 'undefined') {
                console.warn('i18n still undefined after script load, retrying...');
                initI18n();
            }
        }, 200);
    </script>
    <script src="/js/lang-switcher.js" defer></script>
    <style>
        .contact-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        
        .contact-form {
            background: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }
        
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            font-family: inherit;
            box-sizing: border-box;
        }
        
        .form-group textarea {
            min-height: 150px;
            resize: vertical;
        }
        
        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #4a90e2;
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
        }
        
        .submit-btn {
            background: #4a90e2;
            color: white;
            border: none;
            padding: 12px 40px;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
            display: block;
            margin: 30px auto 0;
        }
        
        .submit-btn:hover {
            background: #357abd;
        }
        
        .submit-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .message {
            margin-top: 20px;
            padding: 12px;
            border-radius: 4px;
            text-align: center;
        }
        
        .message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1 data-i18n="contact-title">联系我们</h1>
            <p class="subtitle" data-i18n="contact-subtitle">发消息、提问、获得解答、报告问题或提交建议</p>
        </header>
        
        <div class="contact-container">
            <div class="contact-form">
                <form id="contact-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="name" data-i18n="contact-name">姓名：</label>
                            <input type="text" id="name" name="name" data-i18n="contact-name-placeholder" placeholder="姓名" required>
                        </div>
                        <div class="form-group">
                            <label for="email" data-i18n="contact-email">电子邮件地址：</label>
                            <input type="email" id="email" name="email" data-i18n="contact-email-placeholder" placeholder="电子邮件地址" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="subject" data-i18n="contact-subject">主题：</label>
                        <input type="text" id="subject" name="subject" data-i18n="contact-subject-placeholder" placeholder="主题" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="message" data-i18n="contact-message">消息：</label>
                        <textarea id="message" name="message" data-i18n="contact-message-placeholder" placeholder="我们如何可以帮助您？" required></textarea>
                    </div>
                    
                    <button type="submit" class="submit-btn" data-i18n="contact-submit">提交</button>
                    
                    <div id="form-message" class="message" style="display: none;"></div>
                </form>
            </div>
        </div>
        
        <footer>
            <p data-i18n="footer-text">© 在线工具箱 - 实用工具集合</p>
            <p><a href="/index.html" data-i18n="back-home">← 返回首页</a></p>
        </footer>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <script>
        // EmailJS 配置
        const EMAILJS_PUBLIC_KEY = "IpPyw733tk95swl0J";  // EmailJS Public Key
        const EMAILJS_SERVICE_ID = "service_05uf2zt";  // EmailJS Service ID
        const EMAILJS_TEMPLATE_ID = "template_xmyuwka"; // EmailJS Template ID
        const TO_EMAIL = "1372143376@qq.com"; // 接收邮件的邮箱
        
        // 初始化 EmailJS
        (function() {
            if (EMAILJS_PUBLIC_KEY !== "YOUR_PUBLIC_KEY") {
                emailjs.init(EMAILJS_PUBLIC_KEY);
            }
        })();
        
        // 检查是否已配置 EmailJS
        function isEmailJSConfigured() {
            return EMAILJS_PUBLIC_KEY !== "YOUR_PUBLIC_KEY" && 
                   EMAILJS_SERVICE_ID !== "YOUR_SERVICE_ID" && 
                   EMAILJS_TEMPLATE_ID !== "YOUR_TEMPLATE_ID";
        }
        
        // 表单提交处理
        document.getElementById('contact-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const submitBtn = document.querySelector('.submit-btn');
            const messageDiv = document.getElementById('form-message');
            const form = this;
            
            // 收集表单数据
            const formData = {
                name: document.getElementById('name').value,
                email: document.getElementById('email').value,
                subject: document.getElementById('subject').value,
                message: document.getElementById('message').value
            };
            
            // 如果 EmailJS 未配置，使用 mailto 链接
            if (!isEmailJSConfigured()) {
                const mailtoLink = `mailto:${TO_EMAIL}?subject=${encodeURIComponent(formData.subject)}&body=${encodeURIComponent(`姓名: ${formData.name}%0A邮箱: ${formData.email}%0A%0A${formData.message}`)}`;
                window.location.href = mailtoLink;
                
                // 显示提示
                messageDiv.className = 'message success';
                messageDiv.textContent = typeof i18n !== 'undefined' && i18n.currentLang === 'en'
                    ? 'Opening email client... If it doesn\'t open, please send email to: ' + TO_EMAIL
                    : '正在打开邮件客户端... 如果未自动打开，请直接发送邮件至：' + TO_EMAIL;
                messageDiv.style.display = 'block';
                form.reset();
                
                setTimeout(function() {
                    messageDiv.style.display = 'none';
                }, 5000);
                return;
            }
            
            // 禁用提交按钮
            submitBtn.disabled = true;
            submitBtn.textContent = typeof i18n !== 'undefined' && i18n.currentLang === 'en' ? 'Sending...' : '发送中...';
            messageDiv.style.display = 'none';
            
            // 使用 EmailJS 发送邮件
            emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, {
                from_name: formData.name,
                from_email: formData.email,
                subject: formData.subject,
                message: formData.message,
                to_email: TO_EMAIL
            })
            .then(function(response) {
                // 成功
                messageDiv.className = 'message success';
                messageDiv.textContent = typeof i18n !== 'undefined' && i18n.currentLang === 'en' 
                    ? 'Message sent successfully! We will reply to you soon.' 
                    : '消息发送成功！我们会尽快回复您。';
                messageDiv.style.display = 'block';
                form.reset();
                
                // 5秒后隐藏消息
                setTimeout(function() {
                    messageDiv.style.display = 'none';
                }, 5000);
            }, function(error) {
                // 失败 - 提供备用方案
                console.error('EmailJS error:', error);
                messageDiv.className = 'message error';
                const errorMsg = typeof i18n !== 'undefined' && i18n.currentLang === 'en'
                    ? `Failed to send message. Please contact us directly at ${TO_EMAIL}`
                    : `消息发送失败。请直接联系我们：${TO_EMAIL}`;
                messageDiv.innerHTML = errorMsg + '<br><a href="mailto:' + TO_EMAIL + '" style="color: #721c24; text-decoration: underline;">点击这里使用邮件客户端发送</a>';
                messageDiv.style.display = 'block';
            })
            .finally(function() {
                // 恢复提交按钮
                const submitText = typeof i18n !== 'undefined' && i18n.currentLang === 'en' ? 'Submit' : '提交';
                submitBtn.disabled = false;
                submitBtn.textContent = submitText;
            });
        });
        
        // 强制应用语言设置
        function forceApplyLanguage() {
            if (typeof i18n === 'undefined') {
                setTimeout(forceApplyLanguage, 50);
                return;
            }
            
            const savedLang = localStorage.getItem('language');
            if (savedLang && (savedLang === 'zh' || savedLang === 'en')) {
                i18n.currentLang = savedLang;
                document.documentElement.lang = savedLang === 'zh' ? 'zh-CN' : 'en';
                i18n.updatePage();
                setTimeout(function() { i18n.updatePage(); }, 100);
            }
        }
        
        if (document.body && document.querySelectorAll('[data-i18n]').length > 0) {
            setTimeout(forceApplyLanguage, 0);
        }
        
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                setTimeout(forceApplyLanguage, 100);
            });
        } else {
            setTimeout(forceApplyLanguage, 100);
        }
        
        window.addEventListener('load', function() {
            setTimeout(forceApplyLanguage, 200);
        });
    </script>
</body>
</html>

